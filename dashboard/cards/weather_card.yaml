# Carte météo pour la vue Home : température, conditions, humidité, lever/coucher du soleil, alarme
type: custom:button-card
name: null
show_name: false
show_icon: false
styles:
  card:
    - background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(63, 81, 181, 0.1) 100%)
    - border-radius: 20px
    - padding: 16px
    - border: 1px solid rgba(255, 255, 255, 0.1)
  grid:
    - grid-template-areas: '"weather" "sun_alarm"'
    - grid-template-columns: 1fr
    - grid-template-rows: auto auto
    - gap: 12px
custom_fields:
  weather: |
    [[[
      const weather = states['weather.forecast_home'];
      const temp = weather?.attributes?.temperature ?? '—';
      const condition = weather?.state || 'unknown';
      const humidity = weather?.attributes?.humidity ?? '—';
      
      const iconMap = {
        'clear-night': 'mdi:weather-night',
        'cloudy': 'mdi:weather-cloudy',
        'fog': 'mdi:weather-fog',
        'hail': 'mdi:weather-hail',
        'lightning': 'mdi:weather-lightning',
        'lightning-rainy': 'mdi:weather-lightning-rainy',
        'partlycloudy': 'mdi:weather-partly-cloudy',
        'pouring': 'mdi:weather-pouring',
        'rainy': 'mdi:weather-rainy',
        'snowy': 'mdi:weather-snowy',
        'snowy-rainy': 'mdi:weather-snowy-rainy',
        'sunny': 'mdi:weather-sunny',
        'windy': 'mdi:weather-windy',
        'windy-variant': 'mdi:weather-windy-variant'
      };
      
      const conditionMap = {
        'clear-night': 'Clear night',
        'cloudy': 'Cloudy',
        'fog': 'Fog',
        'hail': 'Hail',
        'lightning': 'Thunderstorm',
        'lightning-rainy': 'Rainy thunderstorm',
        'partlycloudy': 'Partly cloudy',
        'pouring': 'Heavy rain',
        'rainy': 'Rainy',
        'snowy': 'Snow',
        'snowy-rainy': 'Sleet',
        'sunny': 'Sunny',
        'windy': 'Windy',
        'windy-variant': 'Windy'
      };
      
      const icon = iconMap[condition] || 'mdi:weather-cloudy';
      const conditionText = conditionMap[condition] || condition;
      
      return `
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 16px;">
            <ha-icon icon="${icon}" style="width: 60px; height: 60px; color: #42A5F5;"></ha-icon>
            <div>
              <div style="font-size: 42px; font-weight: 700; line-height: 1; color: white;">${temp}°C</div>
              <div style="font-size: 14px; opacity: 0.7; margin-top: 4px;">${conditionText}</div>
            </div>
          </div>
          <div style="text-align: right; opacity: 0.7;">
            <div style="font-size: 13px; margin-bottom: 4px;">
              <ha-icon icon="mdi:water-percent" style="width: 14px; vertical-align: middle;"></ha-icon>
              ${humidity}%
            </div>
          </div>
        </div>
      `;
    ]]]
  sun_alarm: |
    [[[
      const sunEntity = states['sun.sun'];
      const sunriseRaw = sunEntity?.attributes?.next_rising;
      const sunsetRaw = sunEntity?.attributes?.next_setting;
      const sunrise = sunriseRaw ? new Date(sunriseRaw).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false}) : '--:--';
      const sunset = sunsetRaw ? new Date(sunsetRaw).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false}) : '--:--';
      const alarm = states['sensor.pixel_9_pro_next_alarm'];
      const alarmTime = alarm && alarm.state !== 'unknown' && alarm.state !== 'unavailable' 
        ? new Date(alarm.state).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false})
        : '--:--';
      
      return `
        <div style="display: flex; gap: 12px; margin-top: 8px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
          <div style="flex: 1; display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 10px;">
            <ha-icon icon="mdi:weather-sunset-up" style="width: 20px; color: #FFA726;"></ha-icon>
            <div style="flex: 1;">
              <div style="font-size: 11px; opacity: 0.6;">Sunrise</div>
              <div style="font-size: 15px; font-weight: 600;">${sunrise}</div>
            </div>
          </div>
          <div style="flex: 1; display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 10px;">
            <ha-icon icon="mdi:weather-sunset-down" style="width: 20px; color: #FF7043;"></ha-icon>
            <div style="flex: 1;">
              <div style="font-size: 11px; opacity: 0.6;">Sunset</div>
              <div style="font-size: 15px; font-weight: 600;">${sunset}</div>
            </div>
          </div>
          <div style="flex: 1; display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(244,67,54,0.1); border-radius: 10px;">
            <ha-icon icon="mdi:alarm" style="width: 20px; color: #EF5350;"></ha-icon>
            <div style="flex: 1;">
              <div style="font-size: 11px; opacity: 0.6;">Alarm</div>
              <div style="font-size: 15px; font-weight: 600;">${alarmTime}</div>
            </div>
          </div>
        </div>
      `;
    ]]]
