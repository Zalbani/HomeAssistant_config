title: Home
icon: mdi:home
path: home
type: sections
max_columns: 4

sections:
  - title: Info
    cards:
      - type: vertical-stack
        cards:
          - type: custom:button-card
            name: null
            show_name: false
            show_icon: false
            styles:
              card:
                - background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(63, 81, 181, 0.1) 100%)
                - border-radius: 20px
                - padding: 16px
                - border: 1px solid rgba(255, 255, 255, 0.1)
              grid:
                - grid-template-areas: '"weather" "sun_alarm"'
                - grid-template-columns: 1fr
                - grid-template-rows: auto auto
                - gap: 12px
            custom_fields:
              weather: |
                [[[
                  const weather = states['weather.forecast_home'];
                  const temp = weather?.attributes?.temperature ?? '—';
                  const condition = weather?.state || 'unknown';
                  const humidity = weather?.attributes?.humidity ?? '—';
                  
                  const iconMap = {
                    'clear-night': 'mdi:weather-night',
                    'cloudy': 'mdi:weather-cloudy',
                    'fog': 'mdi:weather-fog',
                    'hail': 'mdi:weather-hail',
                    'lightning': 'mdi:weather-lightning',
                    'lightning-rainy': 'mdi:weather-lightning-rainy',
                    'partlycloudy': 'mdi:weather-partly-cloudy',
                    'pouring': 'mdi:weather-pouring',
                    'rainy': 'mdi:weather-rainy',
                    'snowy': 'mdi:weather-snowy',
                    'snowy-rainy': 'mdi:weather-snowy-rainy',
                    'sunny': 'mdi:weather-sunny',
                    'windy': 'mdi:weather-windy',
                    'windy-variant': 'mdi:weather-windy-variant'
                  };
                  
                  const conditionMap = {
                    'clear-night': 'Clear night',
                    'cloudy': 'Cloudy',
                    'fog': 'Fog',
                    'hail': 'Hail',
                    'lightning': 'Thunderstorm',
                    'lightning-rainy': 'Rainy thunderstorm',
                    'partlycloudy': 'Partly cloudy',
                    'pouring': 'Heavy rain',
                    'rainy': 'Rainy',
                    'snowy': 'Snow',
                    'snowy-rainy': 'Sleet',
                    'sunny': 'Sunny',
                    'windy': 'Windy',
                    'windy-variant': 'Windy'
                  };
                  
                  const icon = iconMap[condition] || 'mdi:weather-cloudy';
                  const conditionText = conditionMap[condition] || condition;
                  
                  return `
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                      <div style="display: flex; align-items: center; gap: 16px;">
                        <ha-icon icon="${icon}" style="width: 60px; height: 60px; color: #42A5F5;"></ha-icon>
                        <div>
                          <div style="font-size: 42px; font-weight: 700; line-height: 1; color: white;">${temp}°C</div>
                          <div style="font-size: 14px; opacity: 0.7; margin-top: 4px;">${conditionText}</div>
                        </div>
                      </div>
                      <div style="text-align: right; opacity: 0.7;">
                        <div style="font-size: 13px; margin-bottom: 4px;">
                          <ha-icon icon="mdi:water-percent" style="width: 14px; vertical-align: middle;"></ha-icon>
                          ${humidity}%
                        </div>
                      </div>
                    </div>
                  `;
                ]]]
              sun_alarm: |
                [[[
                  const sunEntity = states['sun.sun'];
                  const sunriseRaw = sunEntity?.attributes?.next_rising;
                  const sunsetRaw = sunEntity?.attributes?.next_setting;
                  const sunrise = sunriseRaw ? new Date(sunriseRaw).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false}) : '--:--';
                  const sunset = sunsetRaw ? new Date(sunsetRaw).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false}) : '--:--';
                  const alarm = states['sensor.pixel_9_pro_next_alarm'];
                  const alarmTime = alarm && alarm.state !== 'unknown' && alarm.state !== 'unavailable' 
                    ? new Date(alarm.state).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: false})
                    : '--:--';
                  
                  return `
                    <div style="display: flex; gap: 12px; margin-top: 8px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                      <div style="flex: 1; display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 10px;">
                        <ha-icon icon="mdi:weather-sunset-up" style="width: 20px; color: #FFA726;"></ha-icon>
                        <div style="flex: 1;">
                          <div style="font-size: 11px; opacity: 0.6;">Sunrise</div>
                          <div style="font-size: 15px; font-weight: 600;">${sunrise}</div>
                        </div>
                      </div>
                      <div style="flex: 1; display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 10px;">
                        <ha-icon icon="mdi:weather-sunset-down" style="width: 20px; color: #FF7043;"></ha-icon>
                        <div style="flex: 1;">
                          <div style="font-size: 11px; opacity: 0.6;">Sunset</div>
                          <div style="font-size: 15px; font-weight: 600;">${sunset}</div>
                        </div>
                      </div>
                      <div style="flex: 1; display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(244,67,54,0.1); border-radius: 10px;">
                        <ha-icon icon="mdi:alarm" style="width: 20px; color: #EF5350;"></ha-icon>
                        <div style="flex: 1;">
                          <div style="font-size: 11px; opacity: 0.6;">Alarm</div>
                          <div style="font-size: 15px; font-weight: 600;">${alarmTime}</div>
                        </div>
                      </div>
                    </div>
                  `;
                ]]]

      - type: vertical-stack
        cards:
          - type: custom:button-card
            name: null
            show_name: false
            show_icon: false
            entity: input_select.heating_profile
            tap_action:
              action: navigate
              navigation_path: /overview-dashboard/heating
            styles:
              card:
                - background: linear-gradient(135deg, rgba(255, 87, 34, 0.12) 0%, rgba(244, 67, 54, 0.08) 100%)
                - border-radius: 20px
                - padding: 16px
                - border: 1px solid rgba(255, 255, 255, 0.1)
              grid:
                - grid-template-areas: '"rooms profile"'
                - grid-template-columns: 1fr auto
                - grid-template-rows: auto
                - gap: 12px
              custom_fields:
                rooms:
                  - align-self: center
                profile:
                  - align-self: center
                  - justify-self: end
            custom_fields:
              rooms: |
                [[[
                  const rooms = [
                    { name: 'Living', icon: 'mdi:sofa-outline', temp: 'sensor.living_room_thermometer_temperature', action: 'sensor.living_room_thermostatic_valve_hvac_action' },
                    { name: 'Office', icon: 'mdi:desk', temp: 'sensor.office_thermometer_temperature', action: 'sensor.office_thermostatic_valve_hvac_action' },
                    { name: 'Bedroom', icon: 'mdi:bed-outline', temp: 'sensor.bedroom_thermometer_temperature', action: 'sensor.bedroom_thermostatic_valve_hvac_action' },
                    { name: 'Bath', icon: 'mdi:bathtub-outline', temp: 'sensor.bathroom_thermometer_temperature', action: 'sensor.bathroom_thermostatic_valve_hvac_action' }
                  ];

                  const rows = rooms.map(r => {
                    const t = states[r.temp]?.state;
                    const temp = (t && t !== 'unknown' && t !== 'unavailable') ? parseFloat(t).toFixed(1) : '—';
                    const heating = states[r.action]?.state === 'heating';
                    const color = heating ? '#FF5722' : 'rgba(255,255,255,0.5)';
                    const fire = heating ? '<ha-icon icon="mdi:fire" style="width: 14px; color: #FF5722;"></ha-icon>' : '';
                    return `
                      <div style="display: flex; align-items: center; gap: 8px; padding: 4px 0;">
                        <ha-icon icon="${r.icon}" style="width: 18px; color: ${color};"></ha-icon>
                        <span style="font-size: 13px; color: rgba(255,255,255,0.7); min-width: 52px;">${r.name}</span>
                        <span style="font-size: 14px; font-weight: 600; color: ${color}; min-width: 42px;">${temp}°</span>
                        ${fire}
                      </div>`;
                  }).join('');

                  return `<div style="display: flex; flex-direction: column;">${rows}</div>`;
                ]]]
              profile: |
                [[[
                  const p = states['input_select.heating_profile']?.state || 'off';
                  const iconMap = {
                    'boost': 'mdi:fire-circle', 'confort': 'mdi:radiator', 'eco': 'mdi:leaf',
                    'night': 'mdi:weather-night', 'off': 'mdi:radiator-off'
                  };
                  const colorMap = {
                    'boost': '#F44336', 'confort': '#FF9800', 'eco': '#4CAF50',
                    'night': '#2196F3', 'off': '#9E9E9E'
                  };
                  const icon = iconMap[p] || 'mdi:radiator';
                  const color = colorMap[p] || '#9E9E9E';
                  const label = p.charAt(0).toUpperCase() + p.slice(1);

                  let timerHtml = '';
                  const timer = states['timer.heating_boost'];
                  if (p === 'boost' && timer?.state === 'active' && timer.attributes?.finishes_at) {
                    const fin = new Date(timer.attributes.finishes_at);
                    const now = new Date();
                    const diff = Math.max(0, Math.floor((fin - now) / 1000));
                    const m = Math.floor(diff / 60);
                    const s = diff % 60;
                    timerHtml = `<div style="font-size: 22px; font-weight: 700; color: ${color}; margin-top: 4px;">${m}:${String(s).padStart(2, '0')}</div>
                                 <div style="font-size: 11px; opacity: 0.6;">remaining</div>`;
                  }

                  const collective = states['input_boolean.collective_heating']?.state;
                  const collectiveHtml = collective === 'off'
                    ? '<div style="font-size: 11px; color: #9E9E9E; margin-top: 6px; display: flex; align-items: center; gap: 4px;"><ha-icon icon="mdi:radiator-off" style="width: 12px; color: #9E9E9E;"></ha-icon>Collective OFF</div>'
                    : '';

                  return `
                    <div style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 4px 8px;">
                      <ha-icon icon="${icon}" style="width: 40px; height: 40px; color: ${color};"></ha-icon>
                      <div style="font-size: 15px; font-weight: 700; margin-top: 6px;">${label}</div>
                      ${timerHtml}
                      ${collectiveHtml}
                    </div>`;
                ]]]

  - title: Rooms
    cards:
      - type: horizontal-stack
        cards:
          - !include ../rooms/living_room/overview_card.yaml
          - !include ../rooms/office/overview_card.yaml

      - type: horizontal-stack
        cards:
          - !include ../rooms/bedroom/overview_card.yaml
          - !include ../rooms/kitchen/overview_card.yaml

      - type: horizontal-stack
        cards:
          - !include ../rooms/bathroom/overview_card.yaml
          - !include ../rooms/restroom/overview_card.yaml

      - !include ../rooms/balcony/overview_card.yaml
